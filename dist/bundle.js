!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Imgs2gif=e():t.Imgs2gif=e()}(window,(function(){return function(t){var e={};function n(i){if(e[i])return e[i].exports;var r=e[i]={i:i,l:!1,exports:{}};return t[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=0)}([function(t,e,n){function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}n(1).toString();var o=n(6),s=function(){function t(e){var i=e.data,r=e.api,o=e.config;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.data=i,this.api=r,this.config=o||{},this.config.workerURL=this.config.workerURL||"gif.worker.js",this.config.output=this.config.output||null,this.index=this.api.blocks.getCurrentBlockIndex()+1,this.wrapper={block:document.createElement("div"),renderSettings:document.createElement("div")},this.settings=[{name:"生成GIF",icon:n(8).default}],this.CSS={baseClass:this.api.styles.block,loading:this.api.styles.loader,input:this.api.styles.input,button:this.api.styles.button,settingsButton:this.api.styles.settingsButton,settingsButtonActive:this.api.styles.settingsButtonActive,wrapperBlock:"imgs-to-gif",blockTag:"tag",imagesContainer:"images",gifResult:"gif-result",caption:"imgs-to-gif-caption",disabledBtn:"imgs-to-gif-disabled-btn"}}return r(t,null,[{key:"toolbox",get:function(){return{title:"创建GIF图",icon:n(7).default}}}]),r(t,[{key:"render",value:function(){var t=this;this.wrapper.block=document.createElement("div"),this.wrapper.block.setAttribute("data-title","合成GIF"),this.wrapper.block.classList.add(this.CSS.wrapperBlock),this.wrapper.block.classList.add(this.CSS.blockTag);var e=this._createInput(),n=this._createBtn(),i=document.createElement("button"),r=document.createElement("div");return r.classList.add(this.CSS.imagesContainer),this.wrapper.block.appendChild(i),this.wrapper.block.appendChild(n),this.wrapper.block.appendChild(e),this.wrapper.block.appendChild(r),i.classList.add(this.CSS.button),i.innerText="从本地添加",i.addEventListener("click",(function(t){t.preventDefault(),e.click()})),this.data&&this.data.images&&this.data.images.length>0?(Array.from(this.data.images,(function(e){return t._createImage(e)})),this.wrapper.block):(this.data.images=[],i.click(),this.wrapper.block)}},{key:"_createInput",value:function(){var t=this,e=document.createElement("input");return e.setAttribute("type","file"),e.setAttribute("accept","image/*"),e.setAttribute("multiple",!0),e.addEventListener("change",(function(e){if(e.preventDefault(),e.target.files.length>0)for(var n=0;n<e.target.files.length;n++){var i=e.target.files[n];if(i.type.match(/image\//)&&!i.type.match(/\/gif/)){var r=URL.createObjectURL(i);t.data.images.push(r),t._createImage(r)}}})),e}},{key:"_createBtn",value:function(){var t=this,e=document.createElement("button");return e.classList.add(this.CSS.button),e.innerText="合成",this.api.listeners.on(e,"click",(function(e){if(e.preventDefault(),t.data&&t.data.images&&t.data.images.length>1){t.wrapper.block.classList.remove(t.CSS.blockTag);var n=t.wrapper.block.querySelectorAll("img");t._createGifFromImages(n)}})),e}},{key:"renderSettings",value:function(){return this.wrapper.renderSettings=document.createElement("div"),this.wrapper.renderSettings}},{key:"save",value:function(t){var e={};if(this.data.base64)e={url:this.data.base64};else{var n=t.querySelectorAll("."+this.CSS.imagesContainer+" img");e={images:Array.from(n,(function(t){return t.getAttribute("data-base64")}))}}return e}},{key:"validate",value:function(t){return!(!t.images&&!t.url)}},{key:"_createCaption",value:function(t){var e=document.createElement("div");e.classList.add(this.CSS.input),e.classList.add(this.CSS.caption),e.contentEditable=!0,e.setAttribute("data-placeholder","文字说明"),e.innerHTML=t||"",this.wrapper.block.querySelector("."+this.CSS.gifResult).appendChild(e)}},{key:"_createImage",value:function(t){var e=this,n=new Image;n.onload=function(){var i=t,r=n.naturalWidth,o=n.naturalHeight;if(t.match(/data\:image\/.*\;base64\,/gi))t=URL.createObjectURL(e._dataURLtoBlob(t));else{var s=document.createElement("canvas");s.width=r,s.height=o,s.getContext("2d").drawImage(n,0,0,r,o),n.remove(),i=s.toDataURL()}var a=document.createElement("div");a.innerHTML='<img data-base64="'.concat(i,'" src="').concat(t,'" width="').concat(r,'" height="').concat(o,'" alt="gif">'),e.wrapper.block.querySelector("."+e.CSS.imagesContainer).appendChild(a),a.addEventListener("click",(function(t){t.preventDefault(),a.remove()}))},n.src=t}},{key:"_blobToDataURL",value:function(t,e){var n=new FileReader;n.onload=function(t){e(t.target.result)},n.readAsDataURL(t)}},{key:"_dataURLtoBlob",value:function(t){for(var e=t.split(","),n=e[0].match(/:(.*?);/)[1],i=atob(e[1]),r=i.length,o=new Uint8Array(r);r--;)o[r]=i.charCodeAt(r);return new Blob([o],{type:n})}},{key:"_createGifFromImages",value:function(t){for(var e=this,n=t[0].naturalWidth,i=t[0].naturalHeight,r=new o({workers:2,quality:10,width:n,height:i,workerScript:this.config.workerURL}),s=0;s<t.length;s++){var a=t[s];r.addFrame(a),n=a.naturalWidth,i=a.naturalHeight}r.on("finished",(function(t){e._blobToDataURL(t,(function(r){e.data=Object.assign(e.data,{url:URL.createObjectURL(t),base64:r,caption:"",width:n,height:i}),e._createGif(r)}))})),this.wrapper.block.innerHTML='<div style="height:200px"></div>',this.wrapper.block.classList.toggle(this.api.styles.loader),r.render()}},{key:"_createGif",value:function(t){var e=this;null!=this.config.output?(this.api.blocks.delete(this.index),this.api.blocks.insert(this.config.output,{url:t})):(this.renderSettings=function(){return e.wrapper.renderSettings},this.wrapper.block.innerHTML="",this.wrapper.block.insertAdjacentHTML("beforeend",'<div class="'.concat(this.CSS.gifResult,'"><img  data-src="').concat(this.data.url,'" data-width="').concat(this.data.width,'" data-height="').concat(this.data.height,'" alt="gif" uk-img></div>')),this.wrapper.block.classList.toggle(this.CSS.loading))}}]),t}();t.exports=s},function(t,e,n){var i=n(2);"string"==typeof i&&(i=[[t.i,i,""]]);var r={hmr:!0,transform:void 0,insertInto:void 0};n(4)(i,r);i.locals&&(t.exports=i.locals)},function(t,e,n){(t.exports=n(3)(!1)).push([t.i,".imgs-to-gif {\n    margin: 24px 0;\n}\n\n.tag::before {\n    content: attr(data-title);\n    font-size: 12px;\n    font-weight: 800;\n    color: #6e8a98;\n    background-color: #fff59f;\n    padding: 4px;\n    letter-spacing: 1px;\n}\n\n.imgs-to-gif .images {\n    display: flex;\n    flex-wrap: wrap;\n}\n\n.imgs-to-gif .images img {\n    height: 88px;\n    width: auto;\n    margin: 8px;\n    border: 1px solid #d8d8d8;\n    padding: 4px;\n}\n\n.imgs-to-gif input {\n    display: none;\n}\n\n.imgs-to-gif-caption[contenteditable] {\n    outline: none;\n    border-radius: 0;\n    font-size: 12px;\n    display: inline;\n    width: auto;\n    margin-top: 10px;\n    margin-bottom: 24px;\n    border: none!important;\n    border-bottom: 1px #d8d8d8 solid!important;\n    text-align: center;\n}\n\n.imgs-to-gif-caption[contentEditable=true][data-placeholder]:empty::before {\n    position: absolute;\n    content: attr(data-placeholder);\n    color: #707684;\n    font-weight: normal;\n    opacity: 1;\n    border: none;\n    outline: none;\n}\n\n.imgs-to-gif-caption[contentEditable=true][data-placeholder]:empty:focus::before {\n    opacity: 0;\n    border: none;\n    outline: none;\n}\n\n.imgs-to-gif .add {\n    display: flex;\n    width: 200px;\n    background: #eeeeee;\n    /* height: 88px; */\n    margin: 8px;\n    border-radius: 4px;\n    padding: 28px;\n    /* justify-content: center; */\n    /* align-items: center; */\n    cursor: pointer;\n}\n\n.imgs-to-gif .cdx-button {\n    outline: none;\n    min-width: 98px;\n    margin: 32px;\n}\n\n.imgs-to-gif .gif-result {\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n\n.imgs-to-gif .gif-result img {\n    width: 50%;\n    max-width: 300px;\n}\n\n.imgs-to-gif-disabled-btn {\n    opacity: 0.2;\n    cursor: not-allowed;\n}",""])},function(t,e){t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var r=(s=i,"/*# sourceMappingURL=data:application/json;charset=utf-8;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(s))))+" */"),o=i.sources.map((function(t){return"/*# sourceURL="+i.sourceRoot+t+" */"}));return[n].concat(o).concat([r]).join("\n")}var s;return[n].join("\n")}(e,t);return e[2]?"@media "+e[2]+"{"+n+"}":n})).join("")},e.i=function(t,n){"string"==typeof t&&(t=[[null,t,""]]);for(var i={},r=0;r<this.length;r++){var o=this[r][0];"number"==typeof o&&(i[o]=!0)}for(r=0;r<t.length;r++){var s=t[r];"number"==typeof s[0]&&i[s[0]]||(n&&!s[2]?s[2]=n:n&&(s[2]="("+s[2]+") and ("+n+")"),e.push(s))}},e}},function(t,e,n){var i,r,o={},s=(i=function(){return window&&document&&document.all&&!window.atob},function(){return void 0===r&&(r=i.apply(this,arguments)),r}),a=function(t){return document.querySelector(t)},l=function(t){var e={};return function(t){if("function"==typeof t)return t();if(void 0===e[t]){var n=a.call(this,t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}}(),c=null,h=0,u=[],f=n(5);function p(t,e){for(var n=0;n<t.length;n++){var i=t[n],r=o[i.id];if(r){r.refs++;for(var s=0;s<r.parts.length;s++)r.parts[s](i.parts[s]);for(;s<i.parts.length;s++)r.parts.push(y(i.parts[s],e))}else{var a=[];for(s=0;s<i.parts.length;s++)a.push(y(i.parts[s],e));o[i.id]={id:i.id,refs:1,parts:a}}}}function d(t,e){for(var n=[],i={},r=0;r<t.length;r++){var o=t[r],s=e.base?o[0]+e.base:o[0],a={css:o[1],media:o[2],sourceMap:o[3]};i[s]?i[s].parts.push(a):n.push(i[s]={id:s,parts:[a]})}return n}function g(t,e){var n=l(t.insertInto);if(!n)throw new Error("Couldn't find a style target. This probably means that the value for the 'insertInto' parameter is invalid.");var i=u[u.length-1];if("top"===t.insertAt)i?i.nextSibling?n.insertBefore(e,i.nextSibling):n.appendChild(e):n.insertBefore(e,n.firstChild),u.push(e);else if("bottom"===t.insertAt)n.appendChild(e);else{if("object"!=typeof t.insertAt||!t.insertAt.before)throw new Error("[Style Loader]\n\n Invalid value for parameter 'insertAt' ('options.insertAt') found.\n Must be 'top', 'bottom', or Object.\n (https://github.com/webpack-contrib/style-loader#insertat)\n");var r=l(t.insertInto+" "+t.insertAt.before);n.insertBefore(e,r)}}function m(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t);var e=u.indexOf(t);e>=0&&u.splice(e,1)}function v(t){var e=document.createElement("style");return void 0===t.attrs.type&&(t.attrs.type="text/css"),b(e,t.attrs),g(t,e),e}function b(t,e){Object.keys(e).forEach((function(n){t.setAttribute(n,e[n])}))}function y(t,e){var n,i,r,o;if(e.transform&&t.css){if(!(o=e.transform(t.css)))return function(){};t.css=o}if(e.singleton){var s=h++;n=c||(c=v(e)),i=k.bind(null,n,s,!1),r=k.bind(null,n,s,!0)}else t.sourceMap&&"function"==typeof URL&&"function"==typeof URL.createObjectURL&&"function"==typeof URL.revokeObjectURL&&"function"==typeof Blob&&"function"==typeof btoa?(n=function(t){var e=document.createElement("link");return void 0===t.attrs.type&&(t.attrs.type="text/css"),t.attrs.rel="stylesheet",b(e,t.attrs),g(t,e),e}(e),i=L.bind(null,n,e),r=function(){m(n),n.href&&URL.revokeObjectURL(n.href)}):(n=v(e),i=_.bind(null,n),r=function(){m(n)});return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else r()}}t.exports=function(t,e){if("undefined"!=typeof DEBUG&&DEBUG&&"object"!=typeof document)throw new Error("The style-loader cannot be used in a non-browser environment");(e=e||{}).attrs="object"==typeof e.attrs?e.attrs:{},e.singleton||"boolean"==typeof e.singleton||(e.singleton=s()),e.insertInto||(e.insertInto="head"),e.insertAt||(e.insertAt="bottom");var n=d(t,e);return p(n,e),function(t){for(var i=[],r=0;r<n.length;r++){var s=n[r];(a=o[s.id]).refs--,i.push(a)}t&&p(d(t,e),e);for(r=0;r<i.length;r++){var a;if(0===(a=i[r]).refs){for(var l=0;l<a.parts.length;l++)a.parts[l]();delete o[a.id]}}}};var w,x=(w=[],function(t,e){return w[t]=e,w.filter(Boolean).join("\n")});function k(t,e,n,i){var r=n?"":i.css;if(t.styleSheet)t.styleSheet.cssText=x(e,r);else{var o=document.createTextNode(r),s=t.childNodes;s[e]&&t.removeChild(s[e]),s.length?t.insertBefore(o,s[e]):t.appendChild(o)}}function _(t,e){var n=e.css,i=e.media;if(i&&t.setAttribute("media",i),t.styleSheet)t.styleSheet.cssText=n;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(n))}}function L(t,e,n){var i=n.css,r=n.sourceMap,o=void 0===e.convertToAbsoluteUrls&&r;(e.convertToAbsoluteUrls||o)&&(i=f(i)),r&&(i+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(r))))+" */");var s=new Blob([i],{type:"text/css"}),a=t.href;t.href=URL.createObjectURL(s),a&&URL.revokeObjectURL(a)}},function(t,e){t.exports=function(t){var e="undefined"!=typeof window&&window.location;if(!e)throw new Error("fixUrls requires window.location");if(!t||"string"!=typeof t)return t;var n=e.protocol+"//"+e.host,i=n+e.pathname.replace(/\/[^\/]*$/,"/");return t.replace(/url\s*\(((?:[^)(]|\((?:[^)(]+|\([^)(]*\))*\))*)\)/gi,(function(t,e){var r,o=e.trim().replace(/^"(.*)"$/,(function(t,e){return e})).replace(/^'(.*)'$/,(function(t,e){return e}));return/^(#|data:|http:\/\/|https:\/\/|file:\/\/\/|\s*$)/i.test(o)?t:(r=0===o.indexOf("//")?o:0===o.indexOf("/")?n+o:i+o.replace(/^\.\//,""),"url("+JSON.stringify(r)+")")}))}},function(t,e,n){t.exports=function t(e,n,i){function r(s,a){if(!n[s]){if(!e[s]){if(o)return o(s,!0);var l=new Error("Cannot find module '"+s+"'");throw l.code="MODULE_NOT_FOUND",l}var c=n[s]={exports:{}};e[s][0].call(c.exports,(function(t){var n=e[s][1][t];return r(n||t)}),c,c.exports,t,e,n,i)}return n[s].exports}for(var o=!1,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(t,e,n){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function r(t){return"function"==typeof t}function o(t){return"object"==typeof t&&null!==t}function s(t){return void 0===t}e.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||isNaN(t))throw TypeError("n must be a positive number");return this._maxListeners=t,this},i.prototype.emit=function(t){var e,n,i,a,l,c;if(this._events||(this._events={}),"error"===t&&(!this._events.error||o(this._events.error)&&!this._events.error.length)){if((e=arguments[1])instanceof Error)throw e;var h=new Error('Uncaught, unspecified "error" event. ('+e+")");throw h.context=e,h}if(s(n=this._events[t]))return!1;if(r(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),n.apply(this,a)}else if(o(n))for(a=Array.prototype.slice.call(arguments,1),i=(c=n.slice()).length,l=0;l<i;l++)c[l].apply(this,a);return!0},i.prototype.addListener=function(t,e){var n;if(!r(e))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",t,r(e.listener)?e.listener:e),this._events[t]?o(this._events[t])?this._events[t].push(e):this._events[t]=[this._events[t],e]:this._events[t]=e,o(this._events[t])&&!this._events[t].warned&&(n=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[t].length>n&&(this._events[t].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[t].length),"function"==typeof console.trace&&console.trace()),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(t,e){if(!r(e))throw TypeError("listener must be a function");var n=!1;function i(){this.removeListener(t,i),n||(n=!0,e.apply(this,arguments))}return i.listener=e,this.on(t,i),this},i.prototype.removeListener=function(t,e){var n,i,s,a;if(!r(e))throw TypeError("listener must be a function");if(!this._events||!this._events[t])return this;if(s=(n=this._events[t]).length,i=-1,n===e||r(n.listener)&&n.listener===e)delete this._events[t],this._events.removeListener&&this.emit("removeListener",t,e);else if(o(n)){for(a=s;a-- >0;)if(n[a]===e||n[a].listener&&n[a].listener===e){i=a;break}if(i<0)return this;1===n.length?(n.length=0,delete this._events[t]):n.splice(i,1),this._events.removeListener&&this.emit("removeListener",t,e)}return this},i.prototype.removeAllListeners=function(t){var e,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[t]&&delete this._events[t],this;if(0===arguments.length){for(e in this._events)"removeListener"!==e&&this.removeAllListeners(e);return this.removeAllListeners("removeListener"),this._events={},this}if(r(n=this._events[t]))this.removeListener(t,n);else if(n)for(;n.length;)this.removeListener(t,n[n.length-1]);return delete this._events[t],this},i.prototype.listeners=function(t){return this._events&&this._events[t]?r(this._events[t])?[this._events[t]]:this._events[t].slice():[]},i.prototype.listenerCount=function(t){if(this._events){var e=this._events[t];if(r(e))return 1;if(e)return e.length}return 0},i.listenerCount=function(t,e){return t.listenerCount(e)}},{}],2:[function(t,e,n){var i,r,o,s,a;a=navigator.userAgent.toLowerCase(),s=navigator.platform.toLowerCase(),o="ie"===(i=a.match(/(opera|ie|firefox|chrome|version)[\s\/:]([\w\d\.]+)?.*?(safari|version[\s\/:]([\w\d\.]+)|$)/)||[null,"unknown",0])[1]&&document.documentMode,(r={name:"version"===i[1]?i[3]:i[1],version:o||parseFloat("opera"===i[1]&&i[4]?i[4]:i[2]),platform:{name:a.match(/ip(?:ad|od|hone)/)?"ios":(a.match(/(?:webos|android)/)||s.match(/mac|win|linux/)||["other"])[0]}})[r.name]=!0,r[r.name+parseInt(r.version,10)]=!0,r.platform[r.platform.name]=!0,e.exports=r},{}],3:[function(t,e,n){var i,r,o,s={}.hasOwnProperty,a=[].indexOf||function(t){for(var e=0,n=this.length;e<n;e++)if(e in this&&this[e]===t)return e;return-1},l=[].slice;i=t("events").EventEmitter,o=t("./browser.coffee"),r=function(t){var e,n;function i(t){var n,i,r;for(i in this.running=!1,this.options={},this.frames=[],this.freeWorkers=[],this.activeWorkers=[],this.setOptions(t),e)r=e[i],null==(n=this.options)[i]&&(n[i]=r)}return function(t,e){for(var n in e)s.call(e,n)&&(t[n]=e[n]);function i(){this.constructor=t}i.prototype=e.prototype,t.prototype=new i,t.__super__=e.prototype}(i,t),e={workerScript:"gif.worker.js",workers:2,repeat:0,background:"#fff",quality:10,width:null,height:null,transparent:null,debug:!1,dither:!1},n={delay:500,copy:!1},i.prototype.setOption=function(t,e){if(this.options[t]=e,null!=this._canvas&&("width"===t||"height"===t))return this._canvas[t]=e},i.prototype.setOptions=function(t){var e,n,i;for(e in n=[],t)s.call(t,e)&&(i=t[e],n.push(this.setOption(e,i)));return n},i.prototype.addFrame=function(t,e){var i,r;for(r in null==e&&(e={}),(i={}).transparent=this.options.transparent,n)i[r]=e[r]||n[r];if(null==this.options.width&&this.setOption("width",t.width),null==this.options.height&&this.setOption("height",t.height),"undefined"!=typeof ImageData&&null!==ImageData&&t instanceof ImageData)i.data=t.data;else if("undefined"!=typeof CanvasRenderingContext2D&&null!==CanvasRenderingContext2D&&t instanceof CanvasRenderingContext2D||"undefined"!=typeof WebGLRenderingContext&&null!==WebGLRenderingContext&&t instanceof WebGLRenderingContext)e.copy?i.data=this.getContextData(t):i.context=t;else{if(null==t.childNodes)throw new Error("Invalid image");e.copy?i.data=this.getImageData(t):i.image=t}return this.frames.push(i)},i.prototype.render=function(){var t,e,n;if(this.running)throw new Error("Already running");if(null==this.options.width||null==this.options.height)throw new Error("Width and height must be set prior to rendering");if(this.running=!0,this.nextFrame=0,this.finishedFrames=0,this.imageParts=function(){var t,e,n;for(n=[],t=0,e=this.frames.length;0<=e?t<e:t>e;0<=e?++t:--t)n.push(null);return n}.call(this),e=this.spawnWorkers(),!0===this.options.globalPalette)this.renderNextFrame();else for(t=0,n=e;0<=n?t<n:t>n;0<=n?++t:--t)this.renderNextFrame();return this.emit("start"),this.emit("progress",0)},i.prototype.abort=function(){for(var t;null!=(t=this.activeWorkers.shift());)this.log("killing active worker"),t.terminate();return this.running=!1,this.emit("abort")},i.prototype.spawnWorkers=function(){var t,e,n,i;return t=Math.min(this.options.workers,this.frames.length),function(){n=[];for(var i=e=this.freeWorkers.length;e<=t?i<t:i>t;e<=t?i++:i--)n.push(i);return n}.apply(this).forEach((i=this,function(t){var e;return i.log("spawning worker "+t),(e=new Worker(i.options.workerScript)).onmessage=function(t){return i.activeWorkers.splice(i.activeWorkers.indexOf(e),1),i.freeWorkers.push(e),i.frameFinished(t.data)},i.freeWorkers.push(e)})),t},i.prototype.frameFinished=function(t){var e,n;if(this.log("frame "+t.index+" finished - "+this.activeWorkers.length+" active"),this.finishedFrames++,this.emit("progress",this.finishedFrames/this.frames.length),this.imageParts[t.index]=t,!0===this.options.globalPalette&&(this.options.globalPalette=t.globalPalette,this.log("global palette analyzed"),this.frames.length>2))for(e=1,n=this.freeWorkers.length;1<=n?e<n:e>n;1<=n?++e:--e)this.renderNextFrame();return a.call(this.imageParts,null)>=0?this.renderNextFrame():this.finishRendering()},i.prototype.finishRendering=function(){var t,e,n,i,r,o,s,a,l,c,h,u,f,p,d,g;for(a=0,r=0,l=(p=this.imageParts).length;r<l;r++)a+=((e=p[r]).data.length-1)*e.pageSize+e.cursor;for(a+=e.pageSize-e.cursor,this.log("rendering finished - filesize "+Math.round(a/1e3)+"kb"),t=new Uint8Array(a),u=0,o=0,c=(d=this.imageParts).length;o<c;o++)for(n=s=0,h=(g=(e=d[o]).data).length;s<h;n=++s)f=g[n],t.set(f,u),n===e.data.length-1?u+=e.cursor:u+=e.pageSize;return i=new Blob([t],{type:"image/gif"}),this.emit("finished",i,t)},i.prototype.renderNextFrame=function(){var t,e,n;if(0===this.freeWorkers.length)throw new Error("No free workers");if(!(this.nextFrame>=this.frames.length))return t=this.frames[this.nextFrame++],n=this.freeWorkers.shift(),e=this.getTask(t),this.log("starting frame "+(e.index+1)+" of "+this.frames.length),this.activeWorkers.push(n),n.postMessage(e)},i.prototype.getContextData=function(t){return t.getImageData(0,0,this.options.width,this.options.height).data},i.prototype.getImageData=function(t){var e;return null==this._canvas&&(this._canvas=document.createElement("canvas"),this._canvas.width=this.options.width,this._canvas.height=this.options.height),(e=this._canvas.getContext("2d")).setFill=this.options.background,e.fillRect(0,0,this.options.width,this.options.height),e.drawImage(t,0,0),this.getContextData(e)},i.prototype.getTask=function(t){var e,n;if(n={index:e=this.frames.indexOf(t),last:e===this.frames.length-1,delay:t.delay,transparent:t.transparent,width:this.options.width,height:this.options.height,quality:this.options.quality,dither:this.options.dither,globalPalette:this.options.globalPalette,repeat:this.options.repeat,canTransfer:"chrome"===o.name},null!=t.data)n.data=t.data;else if(null!=t.context)n.data=this.getContextData(t.context);else{if(null==t.image)throw new Error("Invalid frame");n.data=this.getImageData(t.image)}return n},i.prototype.log=function(){var t;if(t=1<=arguments.length?l.call(arguments,0):[],this.options.debug)return console.log.apply(console,t)},i}(i),e.exports=r},{"./browser.coffee":2,events:1}]},{},[3])(3)},function(t,e,n){"use strict";n.r(e),e.default='<svg width="17" height="15" viewBox="0 0 336 276" xmlns="http://www.w3.org/2000/svg"><path d="M291 150V79c0-19-15-34-34-34H79c-19 0-34 15-34 34v42l67-44 81 72 56-29 42 30zm0 52l-43-30-56 30-81-67-66 39v23c0 19 15 34 34 34h178c17 0 31-13 34-29zM79 0h178c44 0 79 35 79 79v118c0 44-35 79-79 79H79c-44 0-79-35-79-79V79C0 35 35 0 79 0z"/></svg>'},function(t,e,n){"use strict";n.r(e),e.default='<svg data-svg="play-circle" height="20" viewBox="0 0 20 20" width="20" xmlns="http://www.w3.org/2000/svg"><polygon fill="#000" points="8.5 7 13.5 10 8.5 13" stroke="#000" stroke-width="1.1"></polygon><circle cx="10" cy="10" fill="none" r="9" stroke="#000" stroke-width="1.1"></circle></svg>'}])}));